{
 "Description": "Data layer for Jacaranda maternal weather alert system",
 "Resources": {
  "MumBaseTableF15CC75C": {
   "Type": "AWS::DynamoDB::Table",
   "Properties": {
    "AttributeDefinitions": [
     {
      "AttributeName": "contact_uuid",
      "AttributeType": "S"
     },
     {
      "AttributeName": "facility_code",
      "AttributeType": "S"
     },
     {
      "AttributeName": "lastAlertedDate",
      "AttributeType": "S"
     }
    ],
    "BillingMode": "PAY_PER_REQUEST",
    "GlobalSecondaryIndexes": [
     {
      "IndexName": "LocationIndex",
      "KeySchema": [
       {
        "AttributeName": "facility_code",
        "KeyType": "HASH"
       },
       {
        "AttributeName": "lastAlertedDate",
        "KeyType": "RANGE"
       }
      ],
      "Projection": {
       "ProjectionType": "ALL"
      }
     }
    ],
    "KeySchema": [
     {
      "AttributeName": "contact_uuid",
      "KeyType": "HASH"
     }
    ],
    "PointInTimeRecoverySpecification": {
     "PointInTimeRecoveryEnabled": true
    },
    "SSESpecification": {
     "SSEEnabled": true
    },
    "StreamSpecification": {
     "StreamViewType": "NEW_AND_OLD_IMAGES"
    },
    "TableName": "MumBaseTable"
   },
   "UpdateReplacePolicy": "Retain",
   "DeletionPolicy": "Retain",
   "Metadata": {
    "aws:cdk:path": "JacarandaDataStack/MumBaseTable/Resource"
   }
  },
  "JacarandaDataBucket8C9BAC96": {
   "Type": "AWS::S3::Bucket",
   "Properties": {
    "BucketEncryption": {
     "ServerSideEncryptionConfiguration": [
      {
       "ServerSideEncryptionByDefault": {
        "SSEAlgorithm": "AES256"
       }
      }
     ]
    },
    "BucketName": "jacaranda-mum-data-423277768248",
    "LifecycleConfiguration": {
     "Rules": [
      {
       "Id": "ArchiveOldData",
       "Status": "Enabled",
       "Transitions": [
        {
         "StorageClass": "INTELLIGENT_TIERING",
         "TransitionInDays": 90
        }
       ]
      }
     ]
    },
    "PublicAccessBlockConfiguration": {
     "BlockPublicAcls": true,
     "BlockPublicPolicy": true,
     "IgnorePublicAcls": true,
     "RestrictPublicBuckets": true
    },
    "VersioningConfiguration": {
     "Status": "Enabled"
    }
   },
   "UpdateReplacePolicy": "Retain",
   "DeletionPolicy": "Retain",
   "Metadata": {
    "aws:cdk:path": "JacarandaDataStack/JacarandaDataBucket/Resource"
   }
  },
  "LocationFetchDLQD8E8F4D7": {
   "Type": "AWS::SQS::Queue",
   "Properties": {
    "MessageRetentionPeriod": 1209600,
    "QueueName": "LocationFetchDLQ",
    "SqsManagedSseEnabled": true
   },
   "UpdateReplacePolicy": "Delete",
   "DeletionPolicy": "Delete",
   "Metadata": {
    "aws:cdk:path": "JacarandaDataStack/LocationFetchDLQ/Resource"
   }
  },
  "LocationFetchQueue91236619": {
   "Type": "AWS::SQS::Queue",
   "Properties": {
    "MessageRetentionPeriod": 345600,
    "QueueName": "LocationFetch",
    "RedrivePolicy": {
     "deadLetterTargetArn": {
      "Fn::GetAtt": [
       "LocationFetchDLQD8E8F4D7",
       "Arn"
      ]
     },
     "maxReceiveCount": 3
    },
    "SqsManagedSseEnabled": true,
    "VisibilityTimeout": 300
   },
   "UpdateReplacePolicy": "Delete",
   "DeletionPolicy": "Delete",
   "Metadata": {
    "aws:cdk:path": "JacarandaDataStack/LocationFetchQueue/Resource"
   }
  },
  "WeatherResultDLQ303B9C4D": {
   "Type": "AWS::SQS::Queue",
   "Properties": {
    "MessageRetentionPeriod": 1209600,
    "QueueName": "WeatherResultDLQ",
    "SqsManagedSseEnabled": true
   },
   "UpdateReplacePolicy": "Delete",
   "DeletionPolicy": "Delete",
   "Metadata": {
    "aws:cdk:path": "JacarandaDataStack/WeatherResultDLQ/Resource"
   }
  },
  "WeatherResultQueueE0248ACE": {
   "Type": "AWS::SQS::Queue",
   "Properties": {
    "MessageRetentionPeriod": 345600,
    "QueueName": "WeatherResult",
    "RedrivePolicy": {
     "deadLetterTargetArn": {
      "Fn::GetAtt": [
       "WeatherResultDLQ303B9C4D",
       "Arn"
      ]
     },
     "maxReceiveCount": 3
    },
    "SqsManagedSseEnabled": true,
    "VisibilityTimeout": 300
   },
   "UpdateReplacePolicy": "Delete",
   "DeletionPolicy": "Delete",
   "Metadata": {
    "aws:cdk:path": "JacarandaDataStack/WeatherResultQueue/Resource"
   }
  },
  "AdviceRequestQueue8CBFDE05": {
   "Type": "AWS::SQS::Queue",
   "Properties": {
    "MessageRetentionPeriod": 345600,
    "QueueName": "AdviceRequest",
    "SqsManagedSseEnabled": true,
    "VisibilityTimeout": 300
   },
   "UpdateReplacePolicy": "Delete",
   "DeletionPolicy": "Delete",
   "Metadata": {
    "aws:cdk:path": "JacarandaDataStack/AdviceRequestQueue/Resource"
   }
  },
  "NotifyQueueB34E1758": {
   "Type": "AWS::SQS::Queue",
   "Properties": {
    "MessageRetentionPeriod": 604800,
    "QueueName": "NotifyQueue",
    "SqsManagedSseEnabled": true,
    "VisibilityTimeout": 300
   },
   "UpdateReplacePolicy": "Delete",
   "DeletionPolicy": "Delete",
   "Metadata": {
    "aws:cdk:path": "JacarandaDataStack/NotifyQueue/Resource"
   }
  },
  "CDKMetadata": {
   "Type": "AWS::CDK::Metadata",
   "Properties": {
    "Analytics": "v2:deflate64:H4sIAAAAAAAA/zWLywrCMBBFv6X7ZEwrLtzqB4jVveQlpGmT2slYJOTfxRRX93A4t4P2IEA0ckWujeejU5BvSWrP5IqPbD5BTtEoyHepRsvOz1ChMNxDPpH2Nv3kRoXhCyFfyVJNK5TCeouRFl3dhdJM9fO3hYVoLAy4e3cdtEcQzYDO8YVCcpOFftsvSfx7/asAAAA="
   },
   "Metadata": {
    "aws:cdk:path": "JacarandaDataStack/CDKMetadata/Default"
   }
  }
 },
 "Outputs": {
  "MumTableName": {
   "Description": "DynamoDB table for maternal profiles",
   "Value": {
    "Ref": "MumBaseTableF15CC75C"
   }
  },
  "DataBucketName": {
   "Description": "S3 bucket for data uploads",
   "Value": {
    "Ref": "JacarandaDataBucket8C9BAC96"
   }
  },
  "LocationFetchQueueUrl": {
   "Description": "SQS queue for location fetch",
   "Value": {
    "Ref": "LocationFetchQueue91236619"
   }
  },
  "NotifyQueueUrl": {
   "Description": "SQS queue for final notifications",
   "Value": {
    "Ref": "NotifyQueueB34E1758"
   }
  },
  "ExportsOutputFnGetAttMumBaseTableF15CC75CArnC53E9F76": {
   "Value": {
    "Fn::GetAtt": [
     "MumBaseTableF15CC75C",
     "Arn"
    ]
   },
   "Export": {
    "Name": "JacarandaDataStack:ExportsOutputFnGetAttMumBaseTableF15CC75CArnC53E9F76"
   }
  },
  "ExportsOutputFnGetAttLocationFetchQueue91236619ArnF5D7573C": {
   "Value": {
    "Fn::GetAtt": [
     "LocationFetchQueue91236619",
     "Arn"
    ]
   },
   "Export": {
    "Name": "JacarandaDataStack:ExportsOutputFnGetAttLocationFetchQueue91236619ArnF5D7573C"
   }
  },
  "ExportsOutputRefMumBaseTableF15CC75CCF9F04D2": {
   "Value": {
    "Ref": "MumBaseTableF15CC75C"
   },
   "Export": {
    "Name": "JacarandaDataStack:ExportsOutputRefMumBaseTableF15CC75CCF9F04D2"
   }
  },
  "ExportsOutputRefLocationFetchQueue91236619E574A292": {
   "Value": {
    "Ref": "LocationFetchQueue91236619"
   },
   "Export": {
    "Name": "JacarandaDataStack:ExportsOutputRefLocationFetchQueue91236619E574A292"
   }
  },
  "ExportsOutputFnGetAttWeatherResultQueueE0248ACEArn15DCF5A1": {
   "Value": {
    "Fn::GetAtt": [
     "WeatherResultQueueE0248ACE",
     "Arn"
    ]
   },
   "Export": {
    "Name": "JacarandaDataStack:ExportsOutputFnGetAttWeatherResultQueueE0248ACEArn15DCF5A1"
   }
  },
  "ExportsOutputRefWeatherResultQueueE0248ACE7A86D590": {
   "Value": {
    "Ref": "WeatherResultQueueE0248ACE"
   },
   "Export": {
    "Name": "JacarandaDataStack:ExportsOutputRefWeatherResultQueueE0248ACE7A86D590"
   }
  },
  "ExportsOutputFnGetAttNotifyQueueB34E1758Arn0733E2D4": {
   "Value": {
    "Fn::GetAtt": [
     "NotifyQueueB34E1758",
     "Arn"
    ]
   },
   "Export": {
    "Name": "JacarandaDataStack:ExportsOutputFnGetAttNotifyQueueB34E1758Arn0733E2D4"
   }
  },
  "ExportsOutputRefNotifyQueueB34E17580319ED30": {
   "Value": {
    "Ref": "NotifyQueueB34E1758"
   },
   "Export": {
    "Name": "JacarandaDataStack:ExportsOutputRefNotifyQueueB34E17580319ED30"
   }
  },
  "ExportsOutputFnGetAttLocationFetchQueue91236619QueueName00B3E0EE": {
   "Value": {
    "Fn::GetAtt": [
     "LocationFetchQueue91236619",
     "QueueName"
    ]
   },
   "Export": {
    "Name": "JacarandaDataStack:ExportsOutputFnGetAttLocationFetchQueue91236619QueueName00B3E0EE"
   }
  },
  "ExportsOutputFnGetAttWeatherResultQueueE0248ACEQueueName21D206D0": {
   "Value": {
    "Fn::GetAtt": [
     "WeatherResultQueueE0248ACE",
     "QueueName"
    ]
   },
   "Export": {
    "Name": "JacarandaDataStack:ExportsOutputFnGetAttWeatherResultQueueE0248ACEQueueName21D206D0"
   }
  },
  "ExportsOutputFnGetAttNotifyQueueB34E1758QueueName41D06F23": {
   "Value": {
    "Fn::GetAtt": [
     "NotifyQueueB34E1758",
     "QueueName"
    ]
   },
   "Export": {
    "Name": "JacarandaDataStack:ExportsOutputFnGetAttNotifyQueueB34E1758QueueName41D06F23"
   }
  }
 },
 "Parameters": {
  "BootstrapVersion": {
   "Type": "AWS::SSM::Parameter::Value<String>",
   "Default": "/cdk-bootstrap/hnb659fds/version",
   "Description": "Version of the CDK Bootstrap resources in this environment, automatically retrieved from SSM Parameter Store. [cdk:skip]"
  }
 },
 "Rules": {
  "CheckBootstrapVersion": {
   "Assertions": [
    {
     "Assert": {
      "Fn::Not": [
       {
        "Fn::Contains": [
         [
          "1",
          "2",
          "3",
          "4",
          "5"
         ],
         {
          "Ref": "BootstrapVersion"
         }
        ]
       }
      ]
     },
     "AssertDescription": "CDK bootstrap stack version 6 required. Please run 'cdk bootstrap' with a recent version of the CDK CLI."
    }
   ]
  }
 }
}