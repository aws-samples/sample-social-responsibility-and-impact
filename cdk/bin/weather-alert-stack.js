#!/usr/bin/env node
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
require("source-map-support/register");
const cdk = require("aws-cdk-lib");
const cdk_nag_1 = require("cdk-nag");
const data_stack_1 = require("../lib/data-stack");
const compute_stack_1 = require("../lib/compute-stack");
const monitoring_stack_1 = require("../lib/monitoring-stack");
const web_hosting_stack_1 = require("../lib/web-hosting-stack");
const app = new cdk.App();
// Add CDK Nag checks for AWS Solutions best practices
cdk.Aspects.of(app).add(new cdk_nag_1.AwsSolutionsChecks({ verbose: true }));
// Environment configuration
// Uses the region from AWS CLI configuration or CDK_DEFAULT_REGION environment variable
// This allows users to deploy to any AWS region they choose
const env = {
    account: process.env.CDK_DEFAULT_ACCOUNT,
    region: process.env.CDK_DEFAULT_REGION,
};
// Data layer: DynamoDB, S3, SQS
const dataStack = new data_stack_1.WeatherAlertDataStack(app, 'WeatherAlertDataStack', {
    env,
    description: 'Data layer for serverless weather alert system',
});
// Compute layer: Lambda functions, EventBridge, Bedrock
const computeStack = new compute_stack_1.WeatherAlertComputeStack(app, 'WeatherAlertComputeStack', {
    env,
    description: 'Compute layer for serverless weather alert system',
    mumTable: dataStack.mumTable,
    locationFetchQueue: dataStack.locationFetchQueue,
    weatherResultQueue: dataStack.weatherResultQueue,
    adviceRequestQueue: dataStack.adviceRequestQueue,
    notifyQueue: dataStack.notifyQueue,
    dataBucket: dataStack.dataBucket,
});
// Web hosting: CloudFront, Cognito, S3, API Gateway
const webHostingStack = new web_hosting_stack_1.WeatherAlertWebHostingStack(app, 'WeatherAlertWebHostingStack', {
    env,
    description: 'Secure web hosting with CloudFront and Cognito authentication',
    notifyQueue: dataStack.notifyQueue,
});
// Monitoring: CloudWatch dashboards and alarms
const monitoringStack = new monitoring_stack_1.WeatherAlertMonitoringStack(app, 'WeatherAlertMonitoringStack', {
    env,
    description: 'Monitoring and observability for weather alert system',
    profilesToLocationsFn: computeStack.profilesToLocationsFn,
    weatherFetchFn: computeStack.weatherFetchFn,
    adviceFn: computeStack.adviceFn,
    sendAdviceSMSFn: computeStack.sendAdviceSMSFn,
    locationFetchQueue: dataStack.locationFetchQueue,
    weatherResultQueue: dataStack.weatherResultQueue,
    notifyQueue: dataStack.notifyQueue,
});
// Add dependencies
computeStack.addDependency(dataStack);
webHostingStack.addDependency(dataStack);
monitoringStack.addDependency(computeStack);
app.synth();
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoid2VhdGhlci1hbGVydC1zdGFjay5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIndlYXRoZXItYWxlcnQtc3RhY2sudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7O0FBQ0EsdUNBQXFDO0FBQ3JDLG1DQUFtQztBQUNuQyxxQ0FBNkM7QUFDN0Msa0RBQTBEO0FBQzFELHdEQUFnRTtBQUNoRSw4REFBc0U7QUFDdEUsZ0VBQXVFO0FBRXZFLE1BQU0sR0FBRyxHQUFHLElBQUksR0FBRyxDQUFDLEdBQUcsRUFBRSxDQUFDO0FBRTFCLHNEQUFzRDtBQUN0RCxHQUFHLENBQUMsT0FBTyxDQUFDLEVBQUUsQ0FBQyxHQUFHLENBQUMsQ0FBQyxHQUFHLENBQUMsSUFBSSw0QkFBa0IsQ0FBQyxFQUFFLE9BQU8sRUFBRSxJQUFJLEVBQUUsQ0FBQyxDQUFDLENBQUM7QUFFbkUsNEJBQTRCO0FBQzVCLHdGQUF3RjtBQUN4Riw0REFBNEQ7QUFDNUQsTUFBTSxHQUFHLEdBQUc7SUFDVixPQUFPLEVBQUUsT0FBTyxDQUFDLEdBQUcsQ0FBQyxtQkFBbUI7SUFDeEMsTUFBTSxFQUFFLE9BQU8sQ0FBQyxHQUFHLENBQUMsa0JBQWtCO0NBQ3ZDLENBQUM7QUFFRixnQ0FBZ0M7QUFDaEMsTUFBTSxTQUFTLEdBQUcsSUFBSSxrQ0FBcUIsQ0FBQyxHQUFHLEVBQUUsdUJBQXVCLEVBQUU7SUFDeEUsR0FBRztJQUNILFdBQVcsRUFBRSxnREFBZ0Q7Q0FDOUQsQ0FBQyxDQUFDO0FBRUgsd0RBQXdEO0FBQ3hELE1BQU0sWUFBWSxHQUFHLElBQUksd0NBQXdCLENBQUMsR0FBRyxFQUFFLDBCQUEwQixFQUFFO0lBQ2pGLEdBQUc7SUFDSCxXQUFXLEVBQUUsbURBQW1EO0lBQ2hFLFFBQVEsRUFBRSxTQUFTLENBQUMsUUFBUTtJQUM1QixrQkFBa0IsRUFBRSxTQUFTLENBQUMsa0JBQWtCO0lBQ2hELGtCQUFrQixFQUFFLFNBQVMsQ0FBQyxrQkFBa0I7SUFDaEQsa0JBQWtCLEVBQUUsU0FBUyxDQUFDLGtCQUFrQjtJQUNoRCxXQUFXLEVBQUUsU0FBUyxDQUFDLFdBQVc7SUFDbEMsVUFBVSxFQUFFLFNBQVMsQ0FBQyxVQUFVO0NBQ2pDLENBQUMsQ0FBQztBQUVILG9EQUFvRDtBQUNwRCxNQUFNLGVBQWUsR0FBRyxJQUFJLCtDQUEyQixDQUFDLEdBQUcsRUFBRSw2QkFBNkIsRUFBRTtJQUMxRixHQUFHO0lBQ0gsV0FBVyxFQUFFLCtEQUErRDtJQUM1RSxXQUFXLEVBQUUsU0FBUyxDQUFDLFdBQVc7Q0FDbkMsQ0FBQyxDQUFDO0FBRUgsK0NBQStDO0FBQy9DLE1BQU0sZUFBZSxHQUFHLElBQUksOENBQTJCLENBQUMsR0FBRyxFQUFFLDZCQUE2QixFQUFFO0lBQzFGLEdBQUc7SUFDSCxXQUFXLEVBQUUsdURBQXVEO0lBQ3BFLHFCQUFxQixFQUFFLFlBQVksQ0FBQyxxQkFBcUI7SUFDekQsY0FBYyxFQUFFLFlBQVksQ0FBQyxjQUFjO0lBQzNDLFFBQVEsRUFBRSxZQUFZLENBQUMsUUFBUTtJQUMvQixlQUFlLEVBQUUsWUFBWSxDQUFDLGVBQWU7SUFDN0Msa0JBQWtCLEVBQUUsU0FBUyxDQUFDLGtCQUFrQjtJQUNoRCxrQkFBa0IsRUFBRSxTQUFTLENBQUMsa0JBQWtCO0lBQ2hELFdBQVcsRUFBRSxTQUFTLENBQUMsV0FBVztDQUNuQyxDQUFDLENBQUM7QUFFSCxtQkFBbUI7QUFDbkIsWUFBWSxDQUFDLGFBQWEsQ0FBQyxTQUFTLENBQUMsQ0FBQztBQUN0QyxlQUFlLENBQUMsYUFBYSxDQUFDLFNBQVMsQ0FBQyxDQUFDO0FBQ3pDLGVBQWUsQ0FBQyxhQUFhLENBQUMsWUFBWSxDQUFDLENBQUM7QUFFNUMsR0FBRyxDQUFDLEtBQUssRUFBRSxDQUFDIiwic291cmNlc0NvbnRlbnQiOlsiIyEvdXNyL2Jpbi9lbnYgbm9kZVxyXG5pbXBvcnQgJ3NvdXJjZS1tYXAtc3VwcG9ydC9yZWdpc3Rlcic7XHJcbmltcG9ydCAqIGFzIGNkayBmcm9tICdhd3MtY2RrLWxpYic7XHJcbmltcG9ydCB7IEF3c1NvbHV0aW9uc0NoZWNrcyB9IGZyb20gJ2Nkay1uYWcnO1xyXG5pbXBvcnQgeyBXZWF0aGVyQWxlcnREYXRhU3RhY2sgfSBmcm9tICcuLi9saWIvZGF0YS1zdGFjayc7XHJcbmltcG9ydCB7IFdlYXRoZXJBbGVydENvbXB1dGVTdGFjayB9IGZyb20gJy4uL2xpYi9jb21wdXRlLXN0YWNrJztcclxuaW1wb3J0IHsgV2VhdGhlckFsZXJ0TW9uaXRvcmluZ1N0YWNrIH0gZnJvbSAnLi4vbGliL21vbml0b3Jpbmctc3RhY2snO1xyXG5pbXBvcnQgeyBXZWF0aGVyQWxlcnRXZWJIb3N0aW5nU3RhY2sgfSBmcm9tICcuLi9saWIvd2ViLWhvc3Rpbmctc3RhY2snO1xyXG5cclxuY29uc3QgYXBwID0gbmV3IGNkay5BcHAoKTtcclxuXHJcbi8vIEFkZCBDREsgTmFnIGNoZWNrcyBmb3IgQVdTIFNvbHV0aW9ucyBiZXN0IHByYWN0aWNlc1xyXG5jZGsuQXNwZWN0cy5vZihhcHApLmFkZChuZXcgQXdzU29sdXRpb25zQ2hlY2tzKHsgdmVyYm9zZTogdHJ1ZSB9KSk7XHJcblxyXG4vLyBFbnZpcm9ubWVudCBjb25maWd1cmF0aW9uXHJcbi8vIFVzZXMgdGhlIHJlZ2lvbiBmcm9tIEFXUyBDTEkgY29uZmlndXJhdGlvbiBvciBDREtfREVGQVVMVF9SRUdJT04gZW52aXJvbm1lbnQgdmFyaWFibGVcclxuLy8gVGhpcyBhbGxvd3MgdXNlcnMgdG8gZGVwbG95IHRvIGFueSBBV1MgcmVnaW9uIHRoZXkgY2hvb3NlXHJcbmNvbnN0IGVudiA9IHtcclxuICBhY2NvdW50OiBwcm9jZXNzLmVudi5DREtfREVGQVVMVF9BQ0NPVU5ULFxyXG4gIHJlZ2lvbjogcHJvY2Vzcy5lbnYuQ0RLX0RFRkFVTFRfUkVHSU9OLFxyXG59O1xyXG5cclxuLy8gRGF0YSBsYXllcjogRHluYW1vREIsIFMzLCBTUVNcclxuY29uc3QgZGF0YVN0YWNrID0gbmV3IFdlYXRoZXJBbGVydERhdGFTdGFjayhhcHAsICdXZWF0aGVyQWxlcnREYXRhU3RhY2snLCB7XHJcbiAgZW52LFxyXG4gIGRlc2NyaXB0aW9uOiAnRGF0YSBsYXllciBmb3Igc2VydmVybGVzcyB3ZWF0aGVyIGFsZXJ0IHN5c3RlbScsXHJcbn0pO1xyXG5cclxuLy8gQ29tcHV0ZSBsYXllcjogTGFtYmRhIGZ1bmN0aW9ucywgRXZlbnRCcmlkZ2UsIEJlZHJvY2tcclxuY29uc3QgY29tcHV0ZVN0YWNrID0gbmV3IFdlYXRoZXJBbGVydENvbXB1dGVTdGFjayhhcHAsICdXZWF0aGVyQWxlcnRDb21wdXRlU3RhY2snLCB7XHJcbiAgZW52LFxyXG4gIGRlc2NyaXB0aW9uOiAnQ29tcHV0ZSBsYXllciBmb3Igc2VydmVybGVzcyB3ZWF0aGVyIGFsZXJ0IHN5c3RlbScsXHJcbiAgbXVtVGFibGU6IGRhdGFTdGFjay5tdW1UYWJsZSxcclxuICBsb2NhdGlvbkZldGNoUXVldWU6IGRhdGFTdGFjay5sb2NhdGlvbkZldGNoUXVldWUsXHJcbiAgd2VhdGhlclJlc3VsdFF1ZXVlOiBkYXRhU3RhY2sud2VhdGhlclJlc3VsdFF1ZXVlLFxyXG4gIGFkdmljZVJlcXVlc3RRdWV1ZTogZGF0YVN0YWNrLmFkdmljZVJlcXVlc3RRdWV1ZSxcclxuICBub3RpZnlRdWV1ZTogZGF0YVN0YWNrLm5vdGlmeVF1ZXVlLFxyXG4gIGRhdGFCdWNrZXQ6IGRhdGFTdGFjay5kYXRhQnVja2V0LFxyXG59KTtcclxuXHJcbi8vIFdlYiBob3N0aW5nOiBDbG91ZEZyb250LCBDb2duaXRvLCBTMywgQVBJIEdhdGV3YXlcclxuY29uc3Qgd2ViSG9zdGluZ1N0YWNrID0gbmV3IFdlYXRoZXJBbGVydFdlYkhvc3RpbmdTdGFjayhhcHAsICdXZWF0aGVyQWxlcnRXZWJIb3N0aW5nU3RhY2snLCB7XHJcbiAgZW52LFxyXG4gIGRlc2NyaXB0aW9uOiAnU2VjdXJlIHdlYiBob3N0aW5nIHdpdGggQ2xvdWRGcm9udCBhbmQgQ29nbml0byBhdXRoZW50aWNhdGlvbicsXHJcbiAgbm90aWZ5UXVldWU6IGRhdGFTdGFjay5ub3RpZnlRdWV1ZSxcclxufSk7XHJcblxyXG4vLyBNb25pdG9yaW5nOiBDbG91ZFdhdGNoIGRhc2hib2FyZHMgYW5kIGFsYXJtc1xyXG5jb25zdCBtb25pdG9yaW5nU3RhY2sgPSBuZXcgV2VhdGhlckFsZXJ0TW9uaXRvcmluZ1N0YWNrKGFwcCwgJ1dlYXRoZXJBbGVydE1vbml0b3JpbmdTdGFjaycsIHtcclxuICBlbnYsXHJcbiAgZGVzY3JpcHRpb246ICdNb25pdG9yaW5nIGFuZCBvYnNlcnZhYmlsaXR5IGZvciB3ZWF0aGVyIGFsZXJ0IHN5c3RlbScsXHJcbiAgcHJvZmlsZXNUb0xvY2F0aW9uc0ZuOiBjb21wdXRlU3RhY2sucHJvZmlsZXNUb0xvY2F0aW9uc0ZuLFxyXG4gIHdlYXRoZXJGZXRjaEZuOiBjb21wdXRlU3RhY2sud2VhdGhlckZldGNoRm4sXHJcbiAgYWR2aWNlRm46IGNvbXB1dGVTdGFjay5hZHZpY2VGbixcclxuICBzZW5kQWR2aWNlU01TRm46IGNvbXB1dGVTdGFjay5zZW5kQWR2aWNlU01TRm4sXHJcbiAgbG9jYXRpb25GZXRjaFF1ZXVlOiBkYXRhU3RhY2subG9jYXRpb25GZXRjaFF1ZXVlLFxyXG4gIHdlYXRoZXJSZXN1bHRRdWV1ZTogZGF0YVN0YWNrLndlYXRoZXJSZXN1bHRRdWV1ZSxcclxuICBub3RpZnlRdWV1ZTogZGF0YVN0YWNrLm5vdGlmeVF1ZXVlLFxyXG59KTtcclxuXHJcbi8vIEFkZCBkZXBlbmRlbmNpZXNcclxuY29tcHV0ZVN0YWNrLmFkZERlcGVuZGVuY3koZGF0YVN0YWNrKTtcclxud2ViSG9zdGluZ1N0YWNrLmFkZERlcGVuZGVuY3koZGF0YVN0YWNrKTtcclxubW9uaXRvcmluZ1N0YWNrLmFkZERlcGVuZGVuY3koY29tcHV0ZVN0YWNrKTtcclxuXHJcbmFwcC5zeW50aCgpO1xyXG4iXX0=