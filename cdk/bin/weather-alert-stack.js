#!/usr/bin/env node
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
require("source-map-support/register");
const cdk = require("aws-cdk-lib");
const data_stack_1 = require("../lib/data-stack");
const compute_stack_1 = require("../lib/compute-stack");
const monitoring_stack_1 = require("../lib/monitoring-stack");
const web_hosting_stack_1 = require("../lib/web-hosting-stack");
const app = new cdk.App();
// Environment configuration
// Uses the region from AWS CLI configuration or CDK_DEFAULT_REGION environment variable
// This allows users to deploy to any AWS region they choose
const env = {
    account: process.env.CDK_DEFAULT_ACCOUNT,
    region: process.env.CDK_DEFAULT_REGION,
};
// Data layer: DynamoDB, S3, SQS
const dataStack = new data_stack_1.WeatherAlertDataStack(app, 'WeatherAlertDataStack', {
    env,
    description: 'Data layer for serverless weather alert system',
});
// Compute layer: Lambda functions, EventBridge, Bedrock
const computeStack = new compute_stack_1.WeatherAlertComputeStack(app, 'WeatherAlertComputeStack', {
    env,
    description: 'Compute layer for serverless weather alert system',
    mumTable: dataStack.mumTable,
    locationFetchQueue: dataStack.locationFetchQueue,
    weatherResultQueue: dataStack.weatherResultQueue,
    adviceRequestQueue: dataStack.adviceRequestQueue,
    notifyQueue: dataStack.notifyQueue,
    dataBucket: dataStack.dataBucket,
});
// Web hosting: CloudFront, Cognito, S3, API Gateway
const webHostingStack = new web_hosting_stack_1.WeatherAlertWebHostingStack(app, 'WeatherAlertWebHostingStack', {
    env,
    description: 'Secure web hosting with CloudFront and Cognito authentication',
    notifyQueue: dataStack.notifyQueue,
});
// Monitoring: CloudWatch dashboards and alarms
const monitoringStack = new monitoring_stack_1.WeatherAlertMonitoringStack(app, 'WeatherAlertMonitoringStack', {
    env,
    description: 'Monitoring and observability for weather alert system',
    profilesToLocationsFn: computeStack.profilesToLocationsFn,
    weatherFetchFn: computeStack.weatherFetchFn,
    adviceFn: computeStack.adviceFn,
    sendAdviceSMSFn: computeStack.sendAdviceSMSFn,
    locationFetchQueue: dataStack.locationFetchQueue,
    weatherResultQueue: dataStack.weatherResultQueue,
    notifyQueue: dataStack.notifyQueue,
});
// Add dependencies
computeStack.addDependency(dataStack);
webHostingStack.addDependency(dataStack);
monitoringStack.addDependency(computeStack);
app.synth();
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoid2VhdGhlci1hbGVydC1zdGFjay5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIndlYXRoZXItYWxlcnQtc3RhY2sudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7O0FBQ0EsdUNBQXFDO0FBQ3JDLG1DQUFtQztBQUNuQyxrREFBMEQ7QUFDMUQsd0RBQWdFO0FBQ2hFLDhEQUFzRTtBQUN0RSxnRUFBdUU7QUFFdkUsTUFBTSxHQUFHLEdBQUcsSUFBSSxHQUFHLENBQUMsR0FBRyxFQUFFLENBQUM7QUFFMUIsNEJBQTRCO0FBQzVCLHdGQUF3RjtBQUN4Riw0REFBNEQ7QUFDNUQsTUFBTSxHQUFHLEdBQUc7SUFDVixPQUFPLEVBQUUsT0FBTyxDQUFDLEdBQUcsQ0FBQyxtQkFBbUI7SUFDeEMsTUFBTSxFQUFFLE9BQU8sQ0FBQyxHQUFHLENBQUMsa0JBQWtCO0NBQ3ZDLENBQUM7QUFFRixnQ0FBZ0M7QUFDaEMsTUFBTSxTQUFTLEdBQUcsSUFBSSxrQ0FBcUIsQ0FBQyxHQUFHLEVBQUUsdUJBQXVCLEVBQUU7SUFDeEUsR0FBRztJQUNILFdBQVcsRUFBRSxnREFBZ0Q7Q0FDOUQsQ0FBQyxDQUFDO0FBRUgsd0RBQXdEO0FBQ3hELE1BQU0sWUFBWSxHQUFHLElBQUksd0NBQXdCLENBQUMsR0FBRyxFQUFFLDBCQUEwQixFQUFFO0lBQ2pGLEdBQUc7SUFDSCxXQUFXLEVBQUUsbURBQW1EO0lBQ2hFLFFBQVEsRUFBRSxTQUFTLENBQUMsUUFBUTtJQUM1QixrQkFBa0IsRUFBRSxTQUFTLENBQUMsa0JBQWtCO0lBQ2hELGtCQUFrQixFQUFFLFNBQVMsQ0FBQyxrQkFBa0I7SUFDaEQsa0JBQWtCLEVBQUUsU0FBUyxDQUFDLGtCQUFrQjtJQUNoRCxXQUFXLEVBQUUsU0FBUyxDQUFDLFdBQVc7SUFDbEMsVUFBVSxFQUFFLFNBQVMsQ0FBQyxVQUFVO0NBQ2pDLENBQUMsQ0FBQztBQUVILG9EQUFvRDtBQUNwRCxNQUFNLGVBQWUsR0FBRyxJQUFJLCtDQUEyQixDQUFDLEdBQUcsRUFBRSw2QkFBNkIsRUFBRTtJQUMxRixHQUFHO0lBQ0gsV0FBVyxFQUFFLCtEQUErRDtJQUM1RSxXQUFXLEVBQUUsU0FBUyxDQUFDLFdBQVc7Q0FDbkMsQ0FBQyxDQUFDO0FBRUgsK0NBQStDO0FBQy9DLE1BQU0sZUFBZSxHQUFHLElBQUksOENBQTJCLENBQUMsR0FBRyxFQUFFLDZCQUE2QixFQUFFO0lBQzFGLEdBQUc7SUFDSCxXQUFXLEVBQUUsdURBQXVEO0lBQ3BFLHFCQUFxQixFQUFFLFlBQVksQ0FBQyxxQkFBcUI7SUFDekQsY0FBYyxFQUFFLFlBQVksQ0FBQyxjQUFjO0lBQzNDLFFBQVEsRUFBRSxZQUFZLENBQUMsUUFBUTtJQUMvQixlQUFlLEVBQUUsWUFBWSxDQUFDLGVBQWU7SUFDN0Msa0JBQWtCLEVBQUUsU0FBUyxDQUFDLGtCQUFrQjtJQUNoRCxrQkFBa0IsRUFBRSxTQUFTLENBQUMsa0JBQWtCO0lBQ2hELFdBQVcsRUFBRSxTQUFTLENBQUMsV0FBVztDQUNuQyxDQUFDLENBQUM7QUFFSCxtQkFBbUI7QUFDbkIsWUFBWSxDQUFDLGFBQWEsQ0FBQyxTQUFTLENBQUMsQ0FBQztBQUN0QyxlQUFlLENBQUMsYUFBYSxDQUFDLFNBQVMsQ0FBQyxDQUFDO0FBQ3pDLGVBQWUsQ0FBQyxhQUFhLENBQUMsWUFBWSxDQUFDLENBQUM7QUFFNUMsR0FBRyxDQUFDLEtBQUssRUFBRSxDQUFDIiwic291cmNlc0NvbnRlbnQiOlsiIyEvdXNyL2Jpbi9lbnYgbm9kZVxyXG5pbXBvcnQgJ3NvdXJjZS1tYXAtc3VwcG9ydC9yZWdpc3Rlcic7XHJcbmltcG9ydCAqIGFzIGNkayBmcm9tICdhd3MtY2RrLWxpYic7XHJcbmltcG9ydCB7IFdlYXRoZXJBbGVydERhdGFTdGFjayB9IGZyb20gJy4uL2xpYi9kYXRhLXN0YWNrJztcclxuaW1wb3J0IHsgV2VhdGhlckFsZXJ0Q29tcHV0ZVN0YWNrIH0gZnJvbSAnLi4vbGliL2NvbXB1dGUtc3RhY2snO1xyXG5pbXBvcnQgeyBXZWF0aGVyQWxlcnRNb25pdG9yaW5nU3RhY2sgfSBmcm9tICcuLi9saWIvbW9uaXRvcmluZy1zdGFjayc7XHJcbmltcG9ydCB7IFdlYXRoZXJBbGVydFdlYkhvc3RpbmdTdGFjayB9IGZyb20gJy4uL2xpYi93ZWItaG9zdGluZy1zdGFjayc7XHJcblxyXG5jb25zdCBhcHAgPSBuZXcgY2RrLkFwcCgpO1xyXG5cclxuLy8gRW52aXJvbm1lbnQgY29uZmlndXJhdGlvblxyXG4vLyBVc2VzIHRoZSByZWdpb24gZnJvbSBBV1MgQ0xJIGNvbmZpZ3VyYXRpb24gb3IgQ0RLX0RFRkFVTFRfUkVHSU9OIGVudmlyb25tZW50IHZhcmlhYmxlXHJcbi8vIFRoaXMgYWxsb3dzIHVzZXJzIHRvIGRlcGxveSB0byBhbnkgQVdTIHJlZ2lvbiB0aGV5IGNob29zZVxyXG5jb25zdCBlbnYgPSB7XHJcbiAgYWNjb3VudDogcHJvY2Vzcy5lbnYuQ0RLX0RFRkFVTFRfQUNDT1VOVCxcclxuICByZWdpb246IHByb2Nlc3MuZW52LkNES19ERUZBVUxUX1JFR0lPTixcclxufTtcclxuXHJcbi8vIERhdGEgbGF5ZXI6IER5bmFtb0RCLCBTMywgU1FTXHJcbmNvbnN0IGRhdGFTdGFjayA9IG5ldyBXZWF0aGVyQWxlcnREYXRhU3RhY2soYXBwLCAnV2VhdGhlckFsZXJ0RGF0YVN0YWNrJywge1xyXG4gIGVudixcclxuICBkZXNjcmlwdGlvbjogJ0RhdGEgbGF5ZXIgZm9yIHNlcnZlcmxlc3Mgd2VhdGhlciBhbGVydCBzeXN0ZW0nLFxyXG59KTtcclxuXHJcbi8vIENvbXB1dGUgbGF5ZXI6IExhbWJkYSBmdW5jdGlvbnMsIEV2ZW50QnJpZGdlLCBCZWRyb2NrXHJcbmNvbnN0IGNvbXB1dGVTdGFjayA9IG5ldyBXZWF0aGVyQWxlcnRDb21wdXRlU3RhY2soYXBwLCAnV2VhdGhlckFsZXJ0Q29tcHV0ZVN0YWNrJywge1xyXG4gIGVudixcclxuICBkZXNjcmlwdGlvbjogJ0NvbXB1dGUgbGF5ZXIgZm9yIHNlcnZlcmxlc3Mgd2VhdGhlciBhbGVydCBzeXN0ZW0nLFxyXG4gIG11bVRhYmxlOiBkYXRhU3RhY2subXVtVGFibGUsXHJcbiAgbG9jYXRpb25GZXRjaFF1ZXVlOiBkYXRhU3RhY2subG9jYXRpb25GZXRjaFF1ZXVlLFxyXG4gIHdlYXRoZXJSZXN1bHRRdWV1ZTogZGF0YVN0YWNrLndlYXRoZXJSZXN1bHRRdWV1ZSxcclxuICBhZHZpY2VSZXF1ZXN0UXVldWU6IGRhdGFTdGFjay5hZHZpY2VSZXF1ZXN0UXVldWUsXHJcbiAgbm90aWZ5UXVldWU6IGRhdGFTdGFjay5ub3RpZnlRdWV1ZSxcclxuICBkYXRhQnVja2V0OiBkYXRhU3RhY2suZGF0YUJ1Y2tldCxcclxufSk7XHJcblxyXG4vLyBXZWIgaG9zdGluZzogQ2xvdWRGcm9udCwgQ29nbml0bywgUzMsIEFQSSBHYXRld2F5XHJcbmNvbnN0IHdlYkhvc3RpbmdTdGFjayA9IG5ldyBXZWF0aGVyQWxlcnRXZWJIb3N0aW5nU3RhY2soYXBwLCAnV2VhdGhlckFsZXJ0V2ViSG9zdGluZ1N0YWNrJywge1xyXG4gIGVudixcclxuICBkZXNjcmlwdGlvbjogJ1NlY3VyZSB3ZWIgaG9zdGluZyB3aXRoIENsb3VkRnJvbnQgYW5kIENvZ25pdG8gYXV0aGVudGljYXRpb24nLFxyXG4gIG5vdGlmeVF1ZXVlOiBkYXRhU3RhY2subm90aWZ5UXVldWUsXHJcbn0pO1xyXG5cclxuLy8gTW9uaXRvcmluZzogQ2xvdWRXYXRjaCBkYXNoYm9hcmRzIGFuZCBhbGFybXNcclxuY29uc3QgbW9uaXRvcmluZ1N0YWNrID0gbmV3IFdlYXRoZXJBbGVydE1vbml0b3JpbmdTdGFjayhhcHAsICdXZWF0aGVyQWxlcnRNb25pdG9yaW5nU3RhY2snLCB7XHJcbiAgZW52LFxyXG4gIGRlc2NyaXB0aW9uOiAnTW9uaXRvcmluZyBhbmQgb2JzZXJ2YWJpbGl0eSBmb3Igd2VhdGhlciBhbGVydCBzeXN0ZW0nLFxyXG4gIHByb2ZpbGVzVG9Mb2NhdGlvbnNGbjogY29tcHV0ZVN0YWNrLnByb2ZpbGVzVG9Mb2NhdGlvbnNGbixcclxuICB3ZWF0aGVyRmV0Y2hGbjogY29tcHV0ZVN0YWNrLndlYXRoZXJGZXRjaEZuLFxyXG4gIGFkdmljZUZuOiBjb21wdXRlU3RhY2suYWR2aWNlRm4sXHJcbiAgc2VuZEFkdmljZVNNU0ZuOiBjb21wdXRlU3RhY2suc2VuZEFkdmljZVNNU0ZuLFxyXG4gIGxvY2F0aW9uRmV0Y2hRdWV1ZTogZGF0YVN0YWNrLmxvY2F0aW9uRmV0Y2hRdWV1ZSxcclxuICB3ZWF0aGVyUmVzdWx0UXVldWU6IGRhdGFTdGFjay53ZWF0aGVyUmVzdWx0UXVldWUsXHJcbiAgbm90aWZ5UXVldWU6IGRhdGFTdGFjay5ub3RpZnlRdWV1ZSxcclxufSk7XHJcblxyXG4vLyBBZGQgZGVwZW5kZW5jaWVzXHJcbmNvbXB1dGVTdGFjay5hZGREZXBlbmRlbmN5KGRhdGFTdGFjayk7XHJcbndlYkhvc3RpbmdTdGFjay5hZGREZXBlbmRlbmN5KGRhdGFTdGFjayk7XHJcbm1vbml0b3JpbmdTdGFjay5hZGREZXBlbmRlbmN5KGNvbXB1dGVTdGFjayk7XHJcblxyXG5hcHAuc3ludGgoKTtcclxuIl19